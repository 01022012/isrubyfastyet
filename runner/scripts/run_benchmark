#!/usr/bin/env bash

# run_benchmark <benchmark_folder> <rvm_command> <ruby_command> <benchmark_file> <result_file>

source "$HOME/.rvm/scripts/rvm"

cd "$1"
pwd

if rvm "$2@benchmark"
then
	echo 'Sleeping 30 seconds to let the system cool off...'
	sleep 30

	export RUBY_COMMAND="$3"

	echo "benchmarking..."
	echo "$RUBY_COMMAND ($2)"

	eval "($3 $4 || echo 'failed') | tail -1 > $5"
else
	echo "rvm failed to switch to $2" > $5
	exit 1
fi