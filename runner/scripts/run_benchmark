#!/usr/bin/env bash

# run_benchmark <benchmark_folder> <rvm_command> <ruby_command> <benchmark_file> <result_file>

source "$HOME/.rvm/scripts/rvm"

cd "$1"
pwd

rvm "$2@benchmark"

echo 'Sleeping 30 seconds to let the system cool off...'
sleep 30

export RUBY_COMMAND="$3"

echo "benchmarking..."
echo "$RUBY_COMMAND ($2)"

eval "($3 $4 || echo 'failed') | tail -1 > $5"